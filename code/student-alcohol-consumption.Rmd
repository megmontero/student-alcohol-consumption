---
title: "C√≥digo Pr√°ctica 2: Limpieza dataset 'Student Alcohol Consumption '"
author: "Gregorio Andr√©s Garc√≠a Men√©ndez (gagarcia) & Manuel Gomez Montero (megmontero)"
date: "Junio, 2019"
output:
  html_document:
    keep_md: yes
    number_sections: yes
    toc: yes
    toc_depth: 2
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '2'
lang: es
---



```{r setup, include=FALSE}
# Change depending on your working directory
working_directory <- "F:/Drive/M·ster Data Science/TipologÌa y ciclo de la vida de los datos/PRAC2/student-alcohol-consumption"

knitr::opts_chunk$set(echo = TRUE)
options(knitr.kable.NA = '', root.dir = working_directory)
```

```{r load_libraries, include=FALSE}
library(knitr)
```

**Introducci√≥n**

Pr√°ctica 2 de .... chapa... 


Leemos ambos ficheros mostramos resum√©n para matem√°ticas:

```{r}
students.mat=read.table("../data/student-mat.csv",sep=",",header=TRUE)
students.por=read.table("../data/student-por.csv",sep=",",header=TRUE)
summary(students.mat)


```


Y para portugu√©s: 

```{r}
summary(students.por)
```



En el c√≥digo de ejemplo los un√≠a a ver que ver si tiene sentido. ya que no son los mismos alumnos.

```{r}
students=merge(students.mat,students.por,by=c("school","sex","age","address","famsize","Pstatus","Medu","Fedu","Mjob","Fjob","reason","nursery","internet"))
summary(students)
```


Propongo unirlo as√≠ que nos salgan nulos y aplicar una mejor limpieza, habr√≠a que ver que campos son comunes y cuales no.

```{r}
students=merge(students.mat,students.por,by=c("school","sex","age","address","famsize","Pstatus","Medu","Fedu","Mjob","Fjob","reason","guardian","traveltime","schoolsup","famsup","activities","nursery","higher","internet","romantic","famrel","freetime","goout","Dalc","Walc","health","absences"), all = TRUE)
summary(students)

# Save the dataset temporaly 
write.table(students, "../data/students.csv", sep=",", col.names=TRUE, row.names=TRUE, quote=TRUE, na="NA")
```
DespuÈs de hacer varias pruebas quitando y poniendo variables, he llegado a la conclusiÛn de asumir todas como comunes para estudiantes que se encuentran en las dos clases excepto las notas (G1, G2 y G3).
Es decir, asumimos que alumnos cuyo todo conjunto de variables menos las notas es igual en los dos ficheros, se trata del mismo alumno. HaciÈndolo de este modo quedan:
```{r}
# 100 alumnos que dan matem·ticas y portuguÈs 
nrow(students[!is.na(students$G1.x) & !is.na(students$G1.y),])
# 295 alumnos que dan sÛlo matem·ticas
nrow(students[!is.na(students$G1.x) & is.na(students$G1.y),])
# 549 alumnos que dan sÛlo portuguÈs
nrow(students[is.na(students$G1.x) & !is.na(students$G1.y),])
# 0 datos anÛmalos (que no estÈn en ninguna de las dos clases)
nrow(students[is.na(students$G1.x) & is.na(students$G1.y),])
```
Tras tener este dataset, nuestros objetivos pueden ser ver cÛmo influyen ciertos factores sociales (tiempo libre, familia, etc) en dos cosas:
- Consumo de alcohol del alumno
- Calificaciones del alumno
(y la una sobre la otra seg˙n que caso)

Se me ocurre que de este dataset se puede tambiÈn estudiar por ejemplo las calificaciones del alumno por campo (tÈcnico - matem·ticas - y humanidades - portuguÈs). A˙n asÌ, teniendo en cuenta los dos puntos anteriores, veo m·s sentido tener una media de las calificaciones en total que aplicarÌa de la siguiente forma:
========
OPCI”N A
========
- Para los alumnos que est·n en matem·ticas, la media de las tres evaluaciones como calificacion_tec
- Para los alumnos que est·n en portuguÈs, la media de las tres evaluaciones como calificacion_hum
- Para los alumnos que est·n en ambas clases, la media de calificacion_tec y calificacion_hum como calificacion_total
- Los alumnos que no apliquen en calificacion_tec o calificacion_mat, 'NA' como valor, y calificacion_total tambiÈn 'NA'

Creo que asÌ cubrirÌamos bastante terreno seg˙n lo que queramos hacer. A˙n asÌ, algo m·s simple si no nos interesa la calificaciÛn por campos/asignaturas, puede ser:
========
OPCI”N B
========
- Para los alumnos que est·n en matem·ticas, la media de las tres evaluaciones como calificacion_total
- Para los alumnos que est·n en portuguÈs, la media de las tres evaluaciones como calificacion_total

De esta ˙ltima forma queda un dataset m·s "limpio". Dime quÈ opinas. De momento dejo los datasets en dos variables y luego ya elegimos:

```{r}
students_a <- students
students_a$calificacion_tec <- (students_a$G1.x + students_a$G2.x + students_a$G3.x) / 3
students_a$calificacion_hum <- (students_a$G1.y + students_a$G2.y + students_a$G3.y) / 3
students_a$calificacion_total <- (students_a$calificacion_tec + students_a$calificacion_hum) / 2

students_b <- students
students_b$calificacion_total <- ifelse(!is.na(students_a$calificacion_tec), students_a$calificacion_tec, students_a$calificacion_hum)


summary(students_a)
summary(students_b)
```

# PreparaciÛn de datos para ver si existen agrupaciones claras seg˙n ciertas variables

km_data <- students_b
km_data$studytime.x <- NULL
km_data$studytime.y <- NULL
km_data$failures.x <- NULL
km_data$failures.y <- NULL
km_data$paid.x <- NULL
km_data$paid.y <- NULL
km_data$G1.y <- NULL
km_data$G2.y <- NULL
km_data$G3.y <- NULL
km_data$G1.x <- NULL
km_data$G3.x <- NULL
km_data$G2.x <- NULL
km_data$studytime.x <- NULL
km_data$studytime.y <- NULL
km_data$failures.x <- NULL
km_data$failures.y <- NULL
summary(km_data)

# Seguir preparando datos y haciendo pruebas


