---
title: "Código Práctica 2: Limpieza dataset 'Student Alcohol Consumption '"
author: "Gregorio Andrés García Menéndez (gagarcia) & Manuel Gomez Montero (megmontero)"
date: "Junio, 2019"
output:
  html_document:
    keep_md: yes
    number_sections: yes
    toc: yes
    toc_depth: 2
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '2'
lang: es
---



```{r setup, include=FALSE}
# Change depending on your working directory
working_directory <- "F:/Drive/M?ster Data Science/Tipolog?a y ciclo de la vida de los datos/PRAC2/student-alcohol-consumption"

knitr::opts_chunk$set(echo = TRUE)
options(knitr.kable.NA = '', root.dir = working_directory)
```

```{r load_libraries, include=FALSE}
library(knitr)
```

**Introducción**

Práctica 2 de .... chapa... 


Leemos ambos ficheros mostramos resumén para matemáticas:

```{r}
students.mat=read.table("../data/student-mat.csv",sep=",",header=TRUE)
students.por=read.table("../data/student-por.csv",sep=",",header=TRUE)
summary(students.mat)


```


Y para portugués: 

```{r}
summary(students.por)
```



En el código de ejemplo los unía a ver que ver si tiene sentido. ya que no son los mismos alumnos.

```{r}
students=merge(students.mat,students.por,by=c("school","sex","age","address","famsize","Pstatus","Medu","Fedu","Mjob","Fjob","reason","nursery","internet"))
summary(students)
```


```{r}
students.both=merge(students.mat,students.por,by=c("school","sex","age","address","famsize","Pstatus","Medu","Fedu","Mjob","Fjob","reason","nursery","internet", "traveltime", "failures", "schoolsup", "activities", "higher", "romantic", "famrel", "freetime", "goout", "Dalc", "Walc", "health"))
summary(students.both)
```

Vemos cuales realmente serian del mismo conjunto
```{r}
print(nrow(students.both[students$guardian.y!=students$guardian.x,c("guardian.x", "guardian.y")]))
print(nrow(students.both[students$guardian.y!=students$guardian.x,c("famsup.x", "famsup.y")]))
print(nrow(students.both[students$studytime.y!=students$studytime.x,c("studytime.x", "studytime.y")]))
print(nrow(students.both[students$paid.y!=students$paid.x,c("paid.x", "paid.y")]))
print(nrow(students.both[students$absences.y!=students$absences.x,c("absences.x", "absences.y")]))

```

Por lo que creamos el dataset final
```{r}
students=merge(students.mat,students.por,by=c("school","sex","age","address","famsize","Pstatus","Medu","Fedu","Mjob","Fjob","reason","nursery","internet", "traveltime", "failures", "schoolsup", "activities", "higher", "romantic", "famrel", "freetime", "goout", "Dalc", "Walc", "health", "guardian", "famsup", "studytime"), all = TRUE,suffixes = c(".mat",".por"))
summary(students)

# Save the dataset temporaly 
write.table(students, "../data/students.csv", sep=",", col.names=TRUE, row.names=TRUE, quote=TRUE, na="NA")
```


# Análisis gráfico inicial

Alcohol fin de sema y entre semana en función del estado de los padres 
```{r}
par(mfrow=c(1,2))

boxplot(Walc~Pstatus,data=students,  main="Boxplot Weekend Alcohol", ylab="Weekend Alcohol",col=(c("red","blue")))
boxplot(Dalc~Pstatus,data=students,  main="Boxplot Weekdays Alcohol", ylab="Weekdays Alcohol",col=(c("red","blue")))

```

Dirección
```{r}
par(mfrow=c(1,2))
boxplot(Walc~address,data=students,  main="Boxplot Weekend Alcohol", ylab="Weekend Alcohol",col=(c("red","blue")))
boxplot(Dalc~address,data=students,  main="Boxplot Weekdays Alcohol", ylab="Weekdays Alcohol",col=(c("red","blue")))
```
famsize
```{r}
par(mfrow=c(1,2))
boxplot(Walc~famsize,data=students,  main="Boxplot Weekend Alcohol", ylab="Weekend Alcohol",col=(c("red","blue")))
boxplot(Dalc~famsize,data=students,  main="Boxplot Weekdays Alcohol", ylab="Weekdays Alcohol",col=(c("red","blue")))
```
Parece que los mayores beben más entre semana.


Si salen con amigos
```{r}
par(mfrow=c(1,2))
boxplot(Walc~goout,data=students,  main="Boxplot Weekend Alcohol", ylab="Weekend Alcohol",col=(c("red","blue")))
boxplot(Dalc~goout,data=students,  main="Boxplot Weekdays Alcohol", ylab="Weekdays Alcohol",col=(c("red","blue")))
```

Parece que los que más salen, beben más los fines de semana. 

```{r}
par(mfrow=c(1,2))
boxplot(Walc~romantic,data=students,  main="Boxplot Weekend Alcohol", ylab="Weekend Alcohol",col=(c("red","blue")))
boxplot(Dalc~romantic,data=students,  main="Boxplot Weekdays Alcohol", ylab="Weekdays Alcohol",col=(c("red","blue")))
```

El amor da igual 8-).


```{r}
par(mfrow=c(1,2))
boxplot(Walc~studytime,data=students,  main="Boxplot Weekend Alcohol", ylab="Weekend Alcohol",col=(c("red","blue")))
boxplot(Dalc~studytime,data=students,  main="Boxplot Weekdays Alcohol", ylab="Weekdays Alcohol",col=(c("red","blue")))
```

Los que menos estudian, beben más los fines de semana.



```{r}
par(mfrow=c(1,2))
boxplot(Walc~famrel,data=students,  main="Boxplot Weekend Alcohol", ylab="Weekend Alcohol",col=(c("red","blue")))
boxplot(Dalc~famrel,data=students,  main="Boxplot Weekdays Alcohol", ylab="Weekdays Alcohol",col=(c("red","blue")))
```

Los que tienen buena relación con la familia no beben a diario. 






#Backup Goyo

Despu?s de hacer varias pruebas quitando y poniendo variables, he llegado a la conclusi?n de asumir todas como comunes para estudiantes que se encuentran en las dos clases excepto las notas (G1, G2 y G3).
Es decir, asumimos que alumnos cuyo todo conjunto de variables menos las notas es igual en los dos ficheros, se trata del mismo alumno. Haci?ndolo de este modo quedan:
```{r}
# 100 alumnos que dan matem?ticas y portugu?s 
nrow(students[!is.na(students$G1.x) & !is.na(students$G1.y),])
# 295 alumnos que dan s?lo matem?ticas
nrow(students[!is.na(students$G1.x) & is.na(students$G1.y),])
# 549 alumnos que dan s?lo portugu?s
nrow(students[is.na(students$G1.x) & !is.na(students$G1.y),])
# 0 datos an?malos (que no est?n en ninguna de las dos clases)
nrow(students[is.na(students$G1.x) & is.na(students$G1.y),])
```
Tras tener este dataset, nuestros objetivos pueden ser ver c?mo influyen ciertos factores sociales (tiempo libre, familia, etc) en dos cosas:
- Consumo de alcohol del alumno
- Calificaciones del alumno
(y la una sobre la otra seg?n que caso)

Se me ocurre que de este dataset se puede tambi?n estudiar por ejemplo las calificaciones del alumno por campo (técnico - matemáticas - y humanidades - portugués). Aún así, teniendo en cuenta los dos puntos anteriores, veo más sentido tener una media de las calificaciones en total que aplicaría de la siguiente forma:
========
OPCIÓN A
========
- Para los alumnos que están en matemáticas, la media de las tres evaluaciones como calificacion_tec
- Para los alumnos que están en portugués, la media de las tres evaluaciones como calificacion_hum
- Para los alumnos que están en ambas clases, la media de calificacion_tec y calificacion_hum como calificacion_total
- Los alumnos que no apliquen en calificacion_tec o calificacion_mat, 'NA' como valor, y calificacion_total tambi?n 'NA'

Creo que así cubriríamos bastante terreno según lo que queramos hacer. Aún así, algo más simple si no nos interesa la calificación por campos/asignaturas, puede ser:
========
OPCIÓN B
========
- Para los alumnos que están en matemáticas, la media de las tres evaluaciones como calificacion_total
- Para los alumnos que están en portugués, la media de las tres evaluaciones como calificacion_total

De esta última forma queda un dataset más "limpio". Dime qué opinas. De momento dejo los datasets en dos variables y luego ya elegimos:

```{r}
students_a <- students
students_a$calificacion_tec <- (students_a$G1.x + students_a$G2.x + students_a$G3.x) / 3
students_a$calificacion_hum <- (students_a$G1.y + students_a$G2.y + students_a$G3.y) / 3
students_a$calificacion_total <- (students_a$calificacion_tec + students_a$calificacion_hum) / 2

students_b <- students
students_b$calificacion_total <- ifelse(!is.na(students_a$calificacion_tec), students_a$calificacion_tec, students_a$calificacion_hum)


summary(students_a)
summary(students_b)
```

# Preparación de datos para ver si existen agrupaciones claras según ciertas variables

km_data <- students_b
km_data$studytime.x <- NULL
km_data$studytime.y <- NULL
km_data$failures.x <- NULL
km_data$failures.y <- NULL
km_data$paid.x <- NULL
km_data$paid.y <- NULL
km_data$G1.y <- NULL
km_data$G2.y <- NULL
km_data$G3.y <- NULL
km_data$G1.x <- NULL
km_data$G3.x <- NULL
km_data$G2.x <- NULL
km_data$studytime.x <- NULL
km_data$studytime.y <- NULL
km_data$failures.x <- NULL
km_data$failures.y <- NULL
summary(km_data)

# Seguir preparando datos y haciendo pruebas


